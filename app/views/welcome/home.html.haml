= javascript_include_tag 'http://api-maps.yandex.ru/2.0/?load=package.full&lang=ru-RU'
- title 'Доставка воды на дом и в офис в Санкт-Петербурге и Ленинградской области. Питьевая артезианская вода - Прима Аква'
- meta_description 'Prima aqua - доставка воды Санкт-Петербург и Ленинградская область.'
- meta_keywords 'доставка воды, заказ воды, стаканчики, мешалки, помпы, купить'
= render 'layouts/fixed_header'
= include_gon

.main_page
  .water__block
    .water__block__main_image
      -#=image_tag image_url('back_without_bottle.jpg')
      .water__block__main_image__text
        .main_image__text
          .main_image__text__header
            Прима Аква
          .main_image__text__title
            %h2
              Доставка природной воды из Карельского перешейка
          .main_image__text__text
            В экологически чистом районе Карельского перешейка
            находится артезианская скважина №156, дающая
            чистую природную воду гдовского водоносного
            горизонта, которую уже через несколько часов
            привезут в школы, дома и в офисы Северной столицы.
          %a.main_page__button{ href: '/aquas/1' }
            Чем же так хороша Прима Аква
      .infografika
        .infograf_bottles
          = image_tag image_url('main_bottles.png')
        .infogr
          .infogr_price
            %span
              От
            225
            %span.rubles
              Р
          .infogr_line
          .infogr_volume
            .infogr_volume_count
              %span 19
              литров
        .infogr_base.infogr_19
          = image_tag image_url('19.png')
        .infogr_base.infogr_8
          = image_tag image_url('8.png')
        .infogr_base.infogr_6
          = image_tag image_url('6.png')
        .infogr_base.infogr_1
          = image_tag image_url('1.png')
    .little_images
      .carousel
        - @actions.each do |action|
          .action__line
            .action_banner{ style: ("background-image:url(..#{action.preview_image_url(:medium)})" if action.preview_image.present?) }
              %span.action_label
                =link_to action.title, events_show_path(action)
      %span.stretch

  .aquas__block
    .aquas__block__background
      %a{ href: '/aquas/2' }
        .aqua_block.aquas__block__legend
          .aqua_block__info
            .aqua_block__title
              Легенда гор
            .aqua_block__text
              Стимулирует природный механизм самовосстановления организма
      %a{ href: '/aquas/4' }
        .aqua_block.aquas__block__yodis
          .aqua_block__info
            .aqua_block__title
              Йодис
            .aqua_block__text
              Укрепляя иммунитет и помогая энергично осваивать новые знания
      %a{ href: '/aquas/3' }
        .aqua_block.aquas__block__arhyz
          .aqua_block__info
            .aqua_block__title
              Архыз
            .aqua_block__text
              Добывается из горных ледников на высоте 1507 метров над уровнем моря

  .about_company__block
    .about_company__block_image
      -#=image_tag image_url('about.jpg')
      .about_company__text
        .about_company__text__header
          О компании
        .about_company__text__quote
          Группа компаний "Мир Воды" с 2002 года занимается
          обеспечением населения Санкт-Петербурга чистой
          питьевой водой, доставляя в офисы и квартиры бутилированную воду
        .about_company__text__quote_author
        .about_company__text__text
          На сегодня мы имеем современное производство по розливу воды,
          расположенное в удаленном от городской черты экологически чистом
          районе Карельского перешейка. Размещение производства
          непосредственно у скважины соответствует международным
          требованиям Всемирной Организации Здравоохранения,
          запрещающим транспортировку воды к месту бутилирования.
          %br
          %br
          В нашем ассортименте есть вода собственного производства - питьевая
          артезианская вода «Прима Аква» объемом 19л, 8л, 6л, 0.6 л, а также
          кондиционированная вода «Йодис» в 19л. бутылях. По мимо воды
          собственного производства, мы представляем известные по всей России
          бренды минеральной воды: Легенда гор и Архыз.
        %a.main_page__button{ href: '/about' }
          Как мы работаем

  .equipment__block
    .equipment__block_image
      -#=image_tag image_url('equipment.jpg')
      .equipment__block__text
        .equipment__block__text__header
          Оборудование
        .equipment__block__text__text
          Процесс розлива организован таким образом, что до потребителя
          доходит вода, изначальный природный состав которой полностью сохранен.
          %br
          %br
          Предоставляемое нашей фирмой оборудование производится лучшими
          отечественными и зарубежными компаниями и позволяет насладиться
          вкусом и пользой настоящей природной воды. Вы можете подобрать
          лучшее оборудование, соответствующее Вашим вкусам и пожеланиям.
        %a.main_page__button{ href: '/coolers' }
          Каталог оборудования

  .delivery__block
    #delivery__block_map
    .delivery__block_map
      -#=image_tag image_url('map.jpg')
      .delivery__block_map__text
        .delivery__block_map__text__header
          %h1
            Доставка воды
        .delivery__block_map__text__text
          Доставка питьевой воды в офис и на дом по
          Санкт-Петербургу осуществляется с
          понедельника по субботу в удобное для Вас
          время, доставка питьевой воды в пригороды
          Санкт-Петербурга по графику.
          %br
          Доставка питьевой воды в офис и на дом
          оформляется по телефону (812) 335-40-80
          или через наш сайт онлайн.
          %br
          Вы можете самостоятельно оставить заказ воды
          на дом и в офис и наш менеджер перезвонит Вам.
          Для удобства розлива воды из 19л, 8л, 6л бутылей
          мы предлагаем широкий выбор оборудования
          (см. кулеры и помпы).
        %a.main_page__button{ href: '/delivery' }
          Подробнее о доставке


.slides_circles
  .circle
    .circle__block.js_water_block__circle.active__circle
  .circle
    .circle__block.js_aquas_block__circle
  .circle
    .circle__block.js_about_block__circle
  .circle
    .circle__block.js_equipment_block__circle
  .circle
    .circle__block.js_delivery_block__circle


:javascript
  var mousewheelevt=(/Firefox/i.test(navigator.userAgent))? "DOMMouseScroll" : "mousewheel";
  var correcting=(/Firefox/i.test(navigator.userAgent))? -1 : 1;
  $(document).ready(function(){

    default_hover();
    function default_hover(){
      $('.infogr_19').children('img').css('right', '37px');
      $('.infograf_bottles img').removeClass().addClass('l19');
      $('.infogr').css('display', 'block');
      var volume = '<span>19</span> литров';
      var price = '<span>От</span>' + gon.price_19 + '<span class="rubles">Р</span>';
      $('.infogr_volume_count').html(volume);
      $('.infogr_price').html(price);
    }

    function custom_hover(elem, px){
      $(elem).hover(
        function () {
          $('.infogr_19').children('img').css('right', '0');
          $(this).children('img').css('right', px);
          $('.infogr').css('display', 'block');
          var volume = '';
          var price = '<span>От</span>';
          var vol = elem.split('_')[1];
          if (vol == '19'){
            price += gon.price_19+'<span class="rubles">Р</span>';
            volume = '<span>19</span> литров';
          } else if (vol == '8'){
            price += gon.price_8+'<span class="rubles">Р</span>';
            volume = '<span>8</span> литров';
          } else if (vol == '6'){
            price += gon.price_6+'<span class="rubles">Р</span>';
            volume = '<span>6</span> литров';
          } else if (vol == '1'){
            price += gon.price_1+'<span class="rubles">Р</span>';
            volume = '<span>0,6</span> литра';
          }
          $('.infograf_bottles img').removeClass().addClass('l'+vol);
          $('.infogr_volume_count').html(volume);
          $('.infogr_price').html(price);
        },
        function () {
            $(this).children('img').css('right', '0');
            $('.infogr').css('display', 'none');
            default_hover();
        }
      )
    }
    custom_hover('.infogr_19', '37px');
    custom_hover('.infogr_8', '37px');
    custom_hover('.infogr_6', '37px');
    custom_hover('.infogr_1', '35px');


    function activate_circle(name) {
      $('.circle__block').removeClass('active__circle');
      $('.js_'+ name + '_block__circle').addClass('active__circle');
    };

    water = $('.water__block').offset().top - 20;
    aquas = $('.aquas__block').offset().top - 100;
    about = $('.about_company__block').offset().top - 100;
    equip = $('.equipment__block').offset().top - 100;
    deliv = $('.delivery__block').offset().top - 100;

    enableScroll = true;
    flag = false;
    direction = 0;

    el = $(window)[0];
    if (el.addEventListener) {
      if ('onwheel' in document) {
        // IE9+, FF17+, Ch31+
        el.addEventListener("wheel", onWheel);
      } else if ('onmousewheel' in document) {
        // устаревший вариант события
        el.addEventListener("mousewheel", onWheel);
      } else {
        // Firefox < 17
        el.addEventListener("MozMousePixelScroll", onWheel);
      }
    } else { // IE8-
      el.attachEvent("onmousewheel", onWheel);
    };

    function onWheel(e) {
      e = e || window.event;
      if (!enableScroll){
        e.preventDefault ? e.preventDefault() : (e.returnValue = false);
        if (flag){
          flag = false;
          setTimeout(function(){enableScroll = true;}, 500);
        }
        return;
      } else {
        tmp = $( window ).scrollTop();
        delta = e.deltaY || e.detail || e.wheelDelta;
        //direction = delta * correcting;
        direction = delta * -1;
        // console.log(direction + ' , ' + tmp);
        // console.log(water + ' ; ' + about + ' ; ' + equip + ' ; ' + deliv + ' = ' + tmp + ' , ' + direction);

        if (tmp >= 0 && tmp <= water - 1 && direction < 0){
          direction = 0;
          e.preventDefault ? e.preventDefault() : (e.returnValue = false);
          enableScroll = false;
          flag = true;
          $("html, body").animate({ scrollTop: water + "px" });
          activate_circle('water');
        }

        //if (tmp >= equip + 1 && tmp <= equip + 500) {
        if (tmp >= equip - 100 && tmp <= equip + 500 && direction < 0) {
          //console.log('to deliv' + equip + ' ; ' + deliv);
          direction = 0;
          e.preventDefault ? e.preventDefault() : (e.returnValue = false);
          enableScroll = false;
          flag = true;
          $("html, body").animate({ scrollTop: deliv + "px" });
          //$( "body" ).scrollTop(deliv);
          activate_circle('delivery');
        }

        //if (tmp >= about + 1 && tmp <= about + 500) {
        if (tmp >= about - 100 && tmp <= about + 500 && direction < 0) {
          //console.log('to equip' + about + ' ; ' + equip);
          direction = 0;
          e.preventDefault ? e.preventDefault() : (e.returnValue = false);
          enableScroll = false;
          flag = true;
          $("html, body").animate({ scrollTop: equip + "px" });
          //$( "body" ).scrollTop(equip);
          activate_circle('equipment');
        }

        //if (tmp >= water + 1 && tmp <= water + 500) {
        if (tmp >= water - 20 && tmp <= water + 500 && direction < 0) {
          //console.log('to about' + water + ' ; ' + about);
          direction = 0;
          e.preventDefault ? e.preventDefault() : (e.returnValue = false);
          enableScroll = false;
          flag = true;
          $("html, body").animate({ scrollTop: aquas + "px" });
          //$( "body" ).scrollTop(about);
          activate_circle('aquas');
        }

        //if (tmp >= water + 1 && tmp <= water + 500) {
        if (tmp >= aquas - 100 && tmp <= aquas + 500 && direction < 0) {
          //console.log('to about' + water + ' ; ' + about);
          direction = 0;
          e.preventDefault ? e.preventDefault() : (e.returnValue = false);
          enableScroll = false;
          flag = true;
          $("html, body").animate({ scrollTop: about + "px" });
          //$( "body" ).scrollTop(about);
          activate_circle('about');
        }

        //if (tmp >= deliv - 500 && tmp <= deliv - 1) {
        if (tmp >= deliv - 500 && tmp <= deliv + 100 && direction > 0) {
          //console.log('to equip' + deliv + ' ; ' + equip);
          direction = 0;
          e.preventDefault ? e.preventDefault() : (e.returnValue = false);
          enableScroll = false;
          flag = true;
          $("html, body").animate({ scrollTop: equip + "px" });
          //$( "body" ).scrollTop(equip);
          activate_circle('equipment');
        }

        //if (tmp >= equip - 500 && tmp <= equip - 1) {
        if (tmp >= equip - 500 && tmp <= equip + 100 && direction > 0) {
          //console.log('to about' + equip + ' ; ' + about);
          direction = 0;
          e.preventDefault ? e.preventDefault() : (e.returnValue = false);
          enableScroll = false;
          flag = true;
          $("html, body").animate({ scrollTop: about + "px" });
          //$( "body" ).scrollTop(about);
          activate_circle('about');
        }

        if (tmp >= about - 500 && tmp <= about + 100 && direction > 0) {
          direction = 0;
          e.preventDefault ? e.preventDefault() : (e.returnValue = false);
          enableScroll = false;
          flag = true;
          $("html, body").animate({ scrollTop: aquas + "px" });
          activate_circle('aquas');
        }

        if (tmp >= aquas - 500 && tmp <= aquas + 100 && direction > 0) {
          direction = 0;
          e.preventDefault ? e.preventDefault() : (e.returnValue = false);
          enableScroll = false;
          flag = true;
          $("html, body").animate({ scrollTop: water + "px" });
          activate_circle('water');
        }
      }
    };
  })

  ymaps.ready(init);
  function init() {
    var myMap = new ymaps.Map('delivery__block_map', {
      center: [59.750488, 29.62889],
      zoom: 8.7
    });
    myMap.controls.add('smallZoomControl');

    gon.polygons.forEach(function(polygon, i, arr) {
        var myPolygon = new ymaps.Polygon(
          [gon.polygons_coords[i]],
          { hintContent: polygon.hint },
          { fillColor: polygon.color,
            strokeWidth: 1,
            opacity: 0.5
          }
        );
        myMap.geoObjects.add(myPolygon);
    });
  }
